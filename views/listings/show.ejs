<% layout('/layouts/boilerplate') -%>

    <body>
        <div class="row mt-3">
            <div class="col-8 offset-3">
                <h3>
                    <%= listing.title %>
                </h3>
            </div>
            <div class="card col-6 offset-3 show-card listing-card">
                <!--  col-6 => This is part of Bootstrapâ€™s grid system. -->
                <img src="<%= listing.image.url %>" class="card-img-top show-img" alt="listing image">
                <!--   - 6 out of 12 columns on a row -->
                <div class="card-body">
                    <p class="card-text">
                        <br>
                        <%= listing.description %> <br>
                            &#8377 <%= listing.price.toLocaleString('en-IN') %> <br>
                                <%= listing.location %> <br>
                                    <%= listing.country %> <br>
                                        <div class="btns">
                                            <div class="col-md-1">
                                                <button class="btn btn-danger"> <a
                                                        href="/listings/<%= listing._id %>/edit">Edit<a> </button>
                                            </div>
                                            <div class="col-md-1 offset-1">
                                                <form method="POST"
                                                    action="/listings/<%= listing._id %>?_method=DELETE">
                                                    <button type="submit" class="btn btn-outline-dark"> Delete </button>
                                                </form>
                                            </div>
                                        </div>
                    </p>
                </div>
            </div>
            <hr>
            <div>
                <form action="/listings/<%= listing._id %>/reviews" method="post"
                    class="col-6 offset-3 mb-3 needs-validation" novalidate>
                    <h4>Leave Review: </h4>
                    <div class="mt-3 mb-3">
                        <label for="rating">Rate :</label>
                        <input type="range" name="review[rating]" min="1" max="5" id="rating" class="form-range">
                    </div>
                    <div class="mt-3 mb-3">
                        <label for="comment" class="form-label">Share your experience :</label>
                        <br>
                        <textarea name="review[comment]" id="comment" rows="5" cols="30" class="form-control"
                            required></textarea>
                        <div class="invalid-feedback">
                            Enter Feedback Here!
                        </div>
                    </div>
                    <button type="submit" class="btn btn-outline-dark">Submit</button>
                </form>
            </div>
            <div class="col-6 offset-3">
                <hr>
                <hr>
<h4>All Reviews</h4>
<% if(listing.reviews.length === 0) { %>
    <p>No reviews yet.</p>
<% } else { %>
    <% listing.reviews.forEach(function(review, idx) { %>
        <% if (idx % 2 === 0) { %>
            <div class="row">
        <% } %>
                <div class="card col-6 mb-3 ms-2">
                    <div class="card-body">
                        <p class="card-title"><b>User.name</b></p>
                        <p class="card-text">Rating: <%= review.rating %> Stars </p>
                        <p class="card-text">Comment: <%= review.comment %></p>
                    </div>
                </div>
        <% if (idx % 2 === 1 || idx === listing.reviews.length - 1) { %>
            </div>
        <% } %>
    <% }); %>
<% } %>
            </div>
        </div>
    </body>
    <!-- listing.reviews is an array of review objects.
.forEach(function(review) { ... }) loops through each review in the array.
The function(review) { ... } is a callback that runs for every review, allowing you to access and display its properties (like review.rating and review.comment) inside your EJS template. -->